  <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“– Ø§Ù‚Ø±Ø£</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#1e1e1e;
  --panel:#2b2b2b;
  --border:#444;
  --text:#f0f0f0;
  --accent:#ffcc00;
  --green-bg:#e6f9e6;
  --green-panel:#d4f0d4;
  --green-accent:#0a8c0a;
}
.light{
  --bg:#f5f0e1;
  --panel:#f0e6d2;
  --border:#d6c9b6;
  --text:#333;
  --accent:#8d5e06;
}
.green{
  --bg:#f9fff9; 
  --panel:#e6f6e6; 
  --border:#b7d7b7;
  --text:#0a8c0a;
  --accent:var(--green-accent);
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{font-family:'Amiri',serif;background:var(--bg);color:var(--text);overflow-x:hidden;}
.app{display:flex;min-height:100vh;flex-direction:row-reverse;}
.sidebar{width:80%;max-width:260px;background:var(--panel);border-left:1px solid var(--border);padding:12px;position:fixed;right:0;top:0;height:100vh;transform:translateX(100%);transition:.3s;z-index:1000;overflow:auto;border-radius:10px 0 0 10px;}
.sidebar.open{transform:translateX(0);}
.surah-item{padding:10px;border-bottom:1px solid var(--border);cursor:pointer;transition:.2s;}
.surah-item:hover{background:var(--accent);color:#000;font-weight:bold;}
#surahSearch{width:100%;padding:8px 10px;margin-bottom:10px;border-radius:6px;border:none;outline:none;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.3);display:none;z-index:900;}
.content{flex:1;display:flex;flex-direction:column;overflow:hidden;position:relative;}
.header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;padding:10px;background:var(--panel);border-bottom:1px solid var(--border);border-radius:0 0 12px 12px;gap:6px;}
.menu-btn{background:var(--accent);border:none;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:16px;font-weight:bold;color:#000;transition:transform 0.2s,box-shadow 0.2s;}
.menu-btn:hover{transform:scale(1.1);box-shadow:0 0 10px var(--accent);}
.header-title{flex:1;text-align:center;font-size:24px;font-weight:bold;color:var(--accent);}
#scrollInfo{position:sticky;top:0;background:var(--panel);color:var(--accent);padding:6px 10px;font-weight:bold;font-size:16px;border-bottom:1px solid var(--border);text-align:center;z-index:100;display:none;}
.home{flex:1;overflow:auto;padding:10px;display:flex;flex-direction:column;align-items:center;position:relative;margin-bottom:60px;}
#salatBox{width:100%;text-align:center;font-size:18px;color:#000;background:linear-gradient(135deg,var(--accent),#ffaa00);padding:10px 0;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.5);font-weight:bold;z-index:100;margin-bottom:20px;}
.tasbeeh{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:25px;width:100%;max-width:1000px;margin-bottom:20px;}
.circle-box{position:relative;width:100%;max-width:200px;aspect-ratio:1;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;user-select:none;transition:transform 0.2s,box-shadow 0.3s;}
.circle-box:active{transform:scale(1.05);box-shadow:0 0 15px var(--accent),0 0 25px rgba(255,204,0,0.3);}
.circle-number{font-size:48px;color:var(--accent);font-weight:bold;line-height:1.1;text-shadow:0 0 6px rgba(0,0,0,0.5);}
.circle-text{font-size:20px;text-align:center;padding:0 6px;word-wrap:break-word;color:var(--accent);text-shadow:0 0 6px rgba(255,204,0,0.6);}
.circle-svg{position:absolute;inset:0;}
.circle-svg circle{fill:none;stroke-width:8;}
.circle-bg{stroke:var(--panel);}
.circle-progress{stroke:var(--accent);stroke-dasharray:471;stroke-dashoffset:471;transition:.3s;}
.reader{flex:1;overflow:auto;padding:10px;text-align:center;display:none;position:relative;margin-bottom:60px;}
#basmala{font-size:36px;font-weight:bold;margin-bottom:10px;}
.ayah{display:inline-block;margin:6px 4px;line-height:2.2;text-align:center;position:relative;padding:4px 2px;border-radius:8px;transition:background 0.3s;}
.ayah.active-voice{background:rgba(255,204,0,0.2);}
.ayah-number{display:inline-flex;width:36px;height:36px;align-items:center;justify-content:center;border-radius:50%;background:var(--panel);color:var(--accent);font-size:16px;font-weight:bold;cursor:pointer;margin-left:4px;transition:.2s;position:relative;top:-3px;}
.ayah-number.active{background:var(--accent);color:#000;}
.ayah-number.bookmark::after{content:"ğŸ“Œ";position:absolute;top:-10px;right:-10px;font-size:16px;}
.highlight-audio{box-shadow:0 0 15px var(--accent),0 0 30px rgba(255,204,0,0.6);transition:box-shadow 0.3s ease-in-out;}
.next-surah-arrow{margin-top:15px;font-size:48px;cursor:pointer;color:var(--accent);animation:bounce 1s infinite;text-shadow:0 0 10px var(--accent),0 0 20px var(--accent);}
@keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0);}40%{transform:translateY(-10px);}60%{transform:translateY(-5px);}}
.footer{padding:10px;text-align:center;border-top:1px solid var(--border);color:var(--accent);position:relative;z-index:10;background:var(--panel);}
#bookmarkCircle{display:flex;align-items:center;gap:4px;cursor:pointer;font-size:16px;padding:4px 8px;border-radius:8px;background:var(--accent);color:#000;font-weight:bold;transition:.2s;}
#bookmarkCircle:hover{transform:scale(1.1);box-shadow:0 0 10px var(--accent);}
#welcomeModal{direction:rtl;}
@media(max-width:480px){
  .header{flex-wrap:wrap;gap:4px;}
  .menu-btn{font-size:14px;padding:4px 6px;}
  .tasbeeh{margin-bottom:30px;}
  .home{margin-bottom:80px;}
  .reader{margin-bottom:80px;}
}
</style>
</head>
<body>

<!-- Ù†Ø§ÙØ°Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© -->
<div id="welcomeModal" style="position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:2000;visibility:hidden;opacity:0;transition:opacity 0.3s;">
  <div style="background:var(--panel);padding:20px;border-radius:12px;max-width:500px;width:90%;text-align:right;position:relative;direction:rtl;">
    <h2 style="color:var(--accent);margin-bottom:15px;text-align:center;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ğŸ“– Ø§Ù‚Ø±Ø£</h2>
    <p style="margin-bottom:15px;line-height:1.6;">
      Ù‡Ø¯ÙÙ†Ø§ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø¹Ù„Ù‰ <strong>Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø¢ÙŠØ§Øª</strong> ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù‡Ø§.<br><br>
      ğŸ§ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ <strong>Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ©</strong>ØŒ Ø³ÙŠØªÙ… <strong>Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¢ÙŠØ©</strong>.<br>
      ğŸ“Œ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ©ØŒ Ø³ÙŠØªÙ… ÙˆØ¶Ø¹ <strong>Ø¹Ù„Ø§Ù…Ø© Ù„Ù„ØªØ°ÙƒÙŠØ±</strong> Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§.<br><br>
      ğŸŒ™ Ø²Ø± <strong>Ø§Ù„Ø«ÙŠÙ…</strong>: Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¨ÙŠÙ† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†ØŒ Ø§Ù„ÙØ§ØªØ­ØŒ ÙˆØ§Ù„Ø£Ø®Ø¶Ø±.<br>
      â˜° Ø²Ø± <strong>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</strong>: Ù„ÙØªØ­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ± ÙˆØ§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ø³ÙˆØ±Ø©.<br>
      ğŸ  Ø²Ø± <strong>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</strong>: Ù„Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª.<br>
      A+ / A- : Ù„ØªÙƒØ¨ÙŠØ± Ø£Ùˆ ØªØµØºÙŠØ± Ø­Ø¬Ù… Ù†Øµ Ø§Ù„Ø¢ÙŠØ§Øª Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.<br>
      ğŸ“Œ <strong>Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</strong>: Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø¢Ø®Ø± Ø¢ÙŠØ© Ù‚Ù…Øª Ø¨Ø­ÙØ¸Ù‡Ø§.
    </p>
    <button id="closeWelcome" style="background:var(--accent);color:#000;font-weight:bold;padding:8px 15px;border:none;border-radius:8px;cursor:pointer;display:block;margin:auto;">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
  </div>
</div>


<div class="app">
  <div class="sidebar" id="sidebar">
    <h3>ğŸ“– Ø§Ù„Ø³ÙˆØ±</h3>
    <input type="text" id="surahSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³ÙˆØ±Ø©...">
    <div id="surahList"></div>
  </div>
  <div class="overlay" id="overlay" onclick="toggleMenu()"></div>
  <div class="content">
    <div class="header">
      <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
      <button class="menu-btn" onclick="toggleTheme()">ğŸŒ™</button>
      <div class="header-title" id="title">ğŸ“– Ø§Ù‚Ø±Ø£</div>
      <button class="menu-btn" onclick="showHome()">ğŸ </button>
      <button class="menu-btn" onclick="changeFontSize(2)">A+</button>
      <button class="menu-btn" onclick="changeFontSize(-2)">A-</button>
      <div id="bookmarkCircle"><span>ğŸ“Œ</span> <span id="bmSurah">-</span> : <span id="bmAyah">-</span></div>
    </div>
    <div id="scrollInfo">Ø§Ù„Ø¬Ø²Ø¡: <span id="juz-bar">-</span> | Ø§Ù„Ø­Ø²Ø¨: <span id="hizb-bar">-</span></div>
    <div class="home" id="home">
      <div id="salatBox">ØµÙ„Ù‰ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º</div>
      <div class="tasbeeh" id="tasbeeh-container"></div>
    </div>
    <div class="reader" id="reader"></div>
    <div class="footer">ğŸ“– Ø§Ù‚Ø±Ø£ 2026 Â© Ø²ÙŠØ§Ø¯ Ø£ÙŠÙ…Ù† Ø§Ù„Ù…ØºØ±Ø¨ÙŠ</div>
  </div>
</div>

<audio id="tapSound" preload="auto"><source src="https://cdn.pixabay.com/audio/2022/03/15/audio_9b5b4a1a8a.mp3"></audio>

<script>
// ---------- Storage ----------
const storage={get:(k,d)=>JSON.parse(localStorage.getItem(k)||JSON.stringify(d)),set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
let ayahFontSize=22,currentAudio=null,lastActiveAyah=null;

// ---------- Surahs ----------
const allSurahs=[ "Ø§Ù„ÙØ§ØªØ­Ø©","Ø§Ù„Ø¨Ù‚Ø±Ø©","Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†","Ø§Ù„Ù†Ø³Ø§Ø¡","Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©","Ø§Ù„Ø£Ù†Ø¹Ø§Ù…","Ø§Ù„Ø£Ø¹Ø±Ø§Ù","Ø§Ù„Ø£Ù†ÙØ§Ù„","Ø§Ù„ØªÙˆØ¨Ø©",
"ÙŠÙˆÙ†Ø³","Ù‡ÙˆØ¯","ÙŠÙˆØ³Ù","Ø§Ù„Ø±Ø¹Ø¯","Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…","Ø§Ù„Ø­Ø¬Ø±","Ø§Ù„Ù†Ø­Ù„","Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡","Ø§Ù„ÙƒÙ‡Ù","Ù…Ø±ÙŠÙ…","Ø·Ù‡",
"Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡","Ø§Ù„Ø­Ø¬","Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†","Ø§Ù„Ù†ÙˆØ±","Ø§Ù„ÙØ±Ù‚Ø§Ù†","Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡","Ø§Ù„Ù†Ù…Ù„","Ø§Ù„Ù‚ØµØµ","Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª","Ø§Ù„Ø±ÙˆÙ…",
"Ù„Ù‚Ù…Ø§Ù†","Ø§Ù„Ø³Ø¬Ø¯Ø©","Ø§Ù„Ø£Ø­Ø²Ø§Ø¨","Ø³Ø¨Ø£","ÙØ§Ø·Ø±","ÙŠØ³","Ø§Ù„ØµØ§ÙØ§Øª","Øµ","Ø§Ù„Ø²Ù…Ø±","ØºØ§ÙØ±","ÙØµÙ„Øª","Ø§Ù„Ø´ÙˆØ±Ù‰",
"Ø§Ù„Ø²Ø®Ø±Ù","Ø§Ù„Ø¯Ø®Ø§Ù†","Ø§Ù„Ø¬Ø§Ø«ÙŠØ©","Ø§Ù„Ø£Ø­Ù‚Ø§Ù","Ù…Ø­Ù…Ø¯","Ø§Ù„ÙØªØ­","Ø§Ù„Ø­Ø¬Ø±Ø§Øª","Ù‚","Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª","Ø§Ù„Ø·ÙˆØ±","Ø§Ù„Ù†Ø¬Ù…",
"Ø§Ù„Ù‚Ù…Ø±","Ø§Ù„Ø±Ø­Ù…Ù†","Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©","Ø§Ù„Ø­Ø¯ÙŠØ¯","Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©","Ø§Ù„Ø­Ø´Ø±","Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©","Ø§Ù„ØµÙ","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†",
"Ø§Ù„ØªØºØ§Ø¨Ù†","Ø§Ù„Ø·Ù„Ø§Ù‚","Ø§Ù„ØªØ­Ø±ÙŠÙ…","Ø§Ù„Ù…Ù„Ùƒ","Ø§Ù„Ù‚Ù„Ù…","Ø§Ù„Ø­Ø§Ù‚Ø©","Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬","Ù†ÙˆØ­","Ø§Ù„Ø¬Ù†","Ø§Ù„Ù…Ø²Ù…Ù„","Ø§Ù„Ù…Ø¯Ø«Ø±",
"Ø§Ù„Ù‚ÙŠØ§Ù…Ø©","Ø§Ù„Ø¥Ù†Ø³Ø§Ù†","Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª","Ø§Ù„Ù†Ø¨Ø£","Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª","Ø¹Ø¨Ø³","Ø§Ù„ØªÙƒÙˆÙŠØ±","Ø§Ù„Ø¥Ù†ÙØ·Ø§Ø±","Ø§Ù„Ù…Ø·ÙÙÙŠÙ†","Ø§Ù„Ø¥Ù†Ø´Ù‚Ø§Ù‚",
"Ø§Ù„Ø¨Ø±ÙˆØ¬","Ø§Ù„Ø·Ø§Ø±Ù‚","Ø§Ù„Ø£Ø¹Ù„Ù‰","Ø§Ù„ØºØ§Ø´ÙŠØ©","Ø§Ù„ÙØ¬Ø±","Ø§Ù„Ø¨Ù„Ø¯","Ø§Ù„Ø´Ù…Ø³","Ø§Ù„Ù„ÙŠÙ„","Ø§Ù„Ø¶Ø­Ù‰","Ø§Ù„Ø´Ø±Ø­","Ø§Ù„ØªÙŠÙ†",
"Ø§Ù„Ø¹Ù„Ù‚","Ø§Ù„Ù‚Ø¯Ø±","Ø§Ù„Ø¨ÙŠÙ†Ø©","Ø§Ù„Ø²Ù„Ø²Ù„Ø©","Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª","Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©","Ø§Ù„ØªÙƒØ§Ø«Ø±","Ø§Ù„Ø¹ØµØ±","Ø§Ù„Ù‡Ù…Ø²Ø©","Ø§Ù„ÙÙŠÙ„",
"Ù‚Ø±ÙŠØ´","Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†","Ø§Ù„ÙƒÙˆØ«Ø±","Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†","Ø§Ù„Ù†ØµØ±","Ø§Ù„Ù…Ø³Ø¯","Ø§Ù„Ø¥Ø®Ù„Ø§Øµ","Ø§Ù„ÙÙ„Ù‚","Ø§Ù„Ù†Ø§Ø³"];

// ---------- Sidebar ----------
const surahList=document.getElementById("surahList");
const surahSearch=document.getElementById("surahSearch");
function renderSurahList(filter=""){
  surahList.innerHTML="";
  allSurahs.forEach((name,id)=>{
    if(!name.includes(filter)) return;
    const div=document.createElement("div");
    div.className="surah-item";
    div.textContent=(id+1)+" - "+name;
    div.onclick=()=>{loadSurah(id+1,name); toggleMenu();}
    surahList.appendChild(div);
  });
}
renderSurahList();
surahSearch.addEventListener("input",e=>renderSurahList(e.target.value));

// ---------- Bookmark ----------
const bmCircle=document.getElementById("bookmarkCircle");
const bmSurah=document.getElementById("bmSurah");
const bmAyah=document.getElementById("bmAyah");
function saveBookmark(surah,verse){storage.set("bookmark",{surah,verse});bmSurah.textContent=surah;bmAyah.textContent=verse;}
function loadBookmark(){const bm=storage.get("bookmark",null);if(bm){bmSurah.textContent=bm.surah;bmAyah.textContent=bm.verse;}}
bmCircle.onclick=()=>{
  const bm=storage.get("bookmark",null);
  if(!bm){alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¢ÙŠØ© Ù…Ø­ÙÙˆØ¸Ø©"); return;}
  loadSurah(allSurahs.indexOf(bm.surah)+1,bm.surah);
  setTimeout(()=>{
    const target=[...document.querySelectorAll(".ayah-number")].find(n=>n.textContent==bm.verse);
    if(target){target.scrollIntoView({behavior:'smooth',block:'center'}); target.classList.add("highlight-audio"); setTimeout(()=>target.classList.remove("highlight-audio"),2000);}
  },800);
}

// ---------- Home ----------
const home=document.getElementById("home");
const reader=document.getElementById("reader");
const title=document.getElementById("title");
const juzBar=document.getElementById("juz-bar");
const hizbBar=document.getElementById("hizb-bar");
const tasbeehContainer=document.getElementById("tasbeeh-container");
function showHome(){
  if(currentAudio){currentAudio.pause();currentAudio=null;}
  reader.style.display="none"; home.style.display="flex"; title.textContent="ğŸ“– Ø§Ù‚Ø±Ø£"; scrollInfo.style.display="none";
  tasbeehContainer.style.display="grid"; juzBar.textContent='-'; hizbBar.textContent='-';
}

// ---------- Tasbeeh ----------
const tasbeehs=[{id:'c1',text:'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡'},{id:'c2',text:'Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡'},{id:'c3',text:'Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±'},{id:'c4',text:'Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡'},{id:'c5',text:'Ø£Ø´Ù‡Ø¯ Ø£Ù† Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡'},{id:'c6',text:'Ù„Ø§ Ø­ÙˆÙ„ ÙˆÙ„Ø§ Ù‚ÙˆØ© Ø¥Ù„Ø§ Ø¨Ø§Ù„Ù„Ù‡'}];

function initTasbeeh(){
  tasbeehContainer.innerHTML="";
  tasbeehs.forEach(t=>{
    const div=document.createElement("div");
    div.className="circle-box";
    div.id=t.id+"-circle";
    div.innerHTML=`
      <svg class="circle-svg" viewBox="0 0 160 160">
        <circle class="circle-bg" cx="80" cy="80" r="75"/>
        <circle class="circle-progress" id="${t.id}-progress" cx="80" cy="80" r="75"/>
      </svg>
      <div class="circle-number" id="${t.id}">0</div>
      <div class="circle-text">${t.text}</div>
    `;
    tasbeehContainer.appendChild(div);

    let savedCount = storage.get("tasbeeh-"+t.id,0);
    document.getElementById(t.id).textContent = savedCount;
    document.getElementById(t.id+"-progress").style.strokeDashoffset = 471 - (savedCount % 33)/33*471;

    let longPressTimer;
    const startLongPress = () => { 
      longPressTimer=setTimeout(()=>{
        document.getElementById(t.id).textContent = 0;
        document.getElementById(t.id+"-progress").style.strokeDashoffset = 471;
        storage.set("tasbeeh-"+t.id,0);
      },800);
    }
    const cancelLongPress = () => { clearTimeout(longPressTimer); }

    div.addEventListener("mousedown", startLongPress);
    div.addEventListener("touchstart", startLongPress);
    div.addEventListener("mouseup", cancelLongPress);
    div.addEventListener("mouseleave", cancelLongPress);
    div.addEventListener("touchend", cancelLongPress);

    div.addEventListener("click", ()=>{
      let val = +document.getElementById(t.id).textContent + 1;
      document.getElementById(t.id).textContent = val;
      document.getElementById(t.id+"-progress").style.strokeDashoffset = 471-(val%33)/33*471;
      storage.set("tasbeeh-"+t.id,val);
    });
  });
}

// ---------- Font Size ----------
function changeFontSize(delta){ayahFontSize+=delta;if(ayahFontSize<12)ayahFontSize=12;if(ayahFontSize>40)ayahFontSize=40;document.querySelectorAll('.ayah span').forEach(s=>s.style.fontSize=ayahFontSize+"px");}

// ---------- Theme & Menu ----------
const sidebar=document.getElementById("sidebar"); const overlay=document.getElementById("overlay");
function toggleMenu(){sidebar.classList.toggle("open");overlay.style.display=sidebar.classList.contains("open")?"block":"none";}

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… Ù„ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø«Ù„Ø§Ø« Ø£ÙˆØ¶Ø§Ø¹
function toggleTheme() {
  const body = document.body;
  let current = storage.get("theme", "default"); // 'default' | 'light' | 'green'
  if (current === "default") {
    body.classList.remove("green");
    body.classList.add("light");
    storage.set("theme", "light");
  } else if (current === "light") {
    body.classList.remove("light");
    body.classList.add("green");
    storage.set("theme", "green");
  } else {
    body.classList.remove("light", "green");
    storage.set("theme", "default");
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ø¹
window.addEventListener("load", () => {
  const savedTheme = storage.get("theme", "default");
  if (savedTheme === "light") document.body.classList.add("light");
  else if (savedTheme === "green") document.body.classList.add("green");
});

// ---------- Load Surah ----------
function loadSurah(id,name){
  home.style.display="none"; reader.style.display="block"; title.textContent=name; tasbeehContainer.style.display="none"; if(currentAudio){currentAudio.pause();currentAudio=null;} reader.innerHTML="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

  fetch(`https://api.quran.com/api/v4/verses/by_chapter/${id}?fields=text_uthmani,juz_number,hizb_number,verse_number&per_page=400`)
  .then(r=>r.json()).then(d=>{
    reader.innerHTML="";
    if(name!=="Ø§Ù„ØªÙˆØ¨Ø©"){const basmalaDiv=document.createElement("div"); basmalaDiv.id="basmala"; basmalaDiv.textContent="Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…"; reader.appendChild(basmalaDiv);}
    d.verses.forEach((v,index)=>{
      const a=document.createElement("div");a.className="ayah";a.dataset.juz=v.juz_number;a.dataset.hizb=v.hizb_number;
      const txt=document.createElement("span");txt.textContent=v.text_uthmani;txt.style.fontSize=ayahFontSize+"px";
      const num=document.createElement("span");num.className="ayah-number";num.textContent=v.verse_number;
      let longPressTimer=null;

      num.onclick=()=>{
        if(currentAudio){currentAudio.pause();currentAudio=null;}
        if(lastActiveAyah){lastActiveAyah.classList.remove("active"); lastActiveAyah.parentElement.classList.remove("active-voice");}
        if(lastActiveAyah===num){lastActiveAyah=null; return;}
        currentAudio=new Audio(`https://cdn.islamic.network/quran/audio/128/ar.alafasy/${v.id}.mp3`);
        currentAudio.play().catch(()=>{});
        num.classList.add("active");
        a.classList.add("active-voice");
        lastActiveAyah=num;
      }

      const startLongPress=()=>{longPressTimer=setTimeout(()=>{saveBookmark(name,v.verse_number);document.querySelectorAll(".ayah-number.bookmark").forEach(n=>n.classList.remove("bookmark"));num.classList.add("bookmark");},800);}
      const cancelLongPress=()=>{clearTimeout(longPressTimer);}
      num.addEventListener("mousedown",startLongPress);num.addEventListener("touchstart",startLongPress);
      num.addEventListener("mouseup",cancelLongPress);num.addEventListener("touchend",cancelLongPress);

      a.append(txt,num); reader.appendChild(a);

      if(index===d.verses.length-1 && id<allSurahs.length){const arrow=document.createElement("div");arrow.className="next-surah-arrow";arrow.innerHTML="â¬‡";arrow.onclick=()=>loadSurah(id+1,allSurahs[id]);a.appendChild(arrow);}
    });

    const firstAyah = reader.querySelector(".ayah");
    if(firstAyah){juzBar.textContent = firstAyah.dataset.juz; hizbBar.textContent = firstAyah.dataset.hizb; scrollInfo.style.display = "block";}
    const obs=new IntersectionObserver(entries=>{entries.forEach(e=>{if(e.isIntersecting){juzBar.textContent=e.target.dataset.juz; hizbBar.textContent=e.target.dataset.hizb;}});},{root:reader,rootMargin:'-50% 0px -50% 0px',threshold:0});
    [...reader.children].forEach(a=>obs.observe(a));
  });
}

// ---------- Welcome Modal ----------
window.addEventListener("load", () => {
  const hasVisited = storage.get("visited", false);
  const modal = document.getElementById("welcomeModal");
  const closeBtn = document.getElementById("closeWelcome");

  if (!hasVisited) {
    modal.style.visibility = "visible";
    modal.style.opacity = "1";
  }

  closeBtn.onclick = () => {
    modal.style.opacity = "0";
    setTimeout(() => { modal.style.visibility = "hidden"; }, 300);
    storage.set("visited", true); // Ø­ÙØ¸ Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
  };
});

// ---------- Init ----------
window.addEventListener("load",()=>{initTasbeeh();loadBookmark();showHome();});
</script>
</body>
</html>
