 <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#1e1e1e; --panel:#2b2b2b; --border:#444; --text:#f0f0f0; --accent:#ffcc00;
}
.light{--bg:#f5f0e8;--panel:#e0d7cc;--border:#b6a99a;--text:#000;--accent:#6d4c41;}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Amiri',serif;background:var(--bg);color:var(--text);}
.app{display:flex;height:100vh;overflow:hidden;flex-direction:row-reverse;}

/* Sidebar */
.sidebar{
  width:260px;background:var(--panel);border-left:1px solid var(--border);
  padding:12px;position:fixed;right:0;top:0;height:100vh;transform:translateX(100%);
  transition:.3s;z-index:1000;overflow:auto;
}
.sidebar.open{transform:translateX(0);}
.surah-item{padding:10px;border-bottom:1px solid var(--border);cursor:pointer;transition:.2s;}
.surah-item:hover{background:var(--accent);color:#000;font-weight:bold;}
#surahSearch{width:100%;padding:8px 10px;margin-bottom:10px;border-radius:6px;border:none;outline:none;
background:#fff;color:#000;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><circle cx="7" cy="7" r="6" stroke="black" stroke-width="2" fill="none"/><line x1="11" y1="11" x2="16" y2="16" stroke="black" stroke-width="2"/></svg>');
background-repeat:no-repeat;background-position:98% center;background-size:16px;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.3);display:none;z-index:900;}

/* Content */
.content{flex:1;display:flex;flex-direction:column;overflow:hidden;position:relative;}
.header{display:flex;align-items:center;gap:6px;padding:10px;border-bottom:1px solid var(--border);}
.menu-btn{background:var(--accent);border:none;border-radius:8px;padding:6px 10px;cursor:pointer;}
.header-title{flex:1;text-align:center;font-size:22px;color:var(--accent);}
#scrollInfo{position:sticky;top:0;background:var(--panel);color:var(--accent);
padding:6px 10px;font-weight:bold;font-size:16px;border-bottom:1px solid var(--border);text-align:center;z-index:100;display:none;}

/* Tasbeeh */
.home{flex:1;overflow:auto;padding:10px;display:flex;flex-direction:column;align-items:center;}
.tasbeeh{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:20px;width:100%;max-width:900px;}
.circle-box{position:relative;width:100%;max-width:200px;aspect-ratio:1;border-radius:50%;
display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;user-select:none;
-webkit-tap-highlight-color:transparent;transition:.2s;box-shadow:0 0 20px rgba(0,0,0,.3);}
.circle-box:active{transform:scale(.96);box-shadow:0 0 30px var(--accent);}
.circle-number{font-size:54px;color:var(--accent);font-weight:bold;line-height:1.1;}
.circle-text{font-size:18px;text-align:center;padding:0 6px;word-wrap:break-word;}
.circle-svg{position:absolute;inset:0;}
.circle-svg circle{fill:none;stroke-width:8;}
.circle-bg{stroke:var(--panel);}
.circle-progress{stroke:var(--accent);stroke-dasharray:471;stroke-dashoffset:471;transition:.3s;}

/* Reader */
.reader{flex:1;overflow:auto;padding:20px;text-align:center;display:none;position:relative;}
.ayah{display:inline-block;margin:6px 4px;line-height:2.2;text-align:center;}
.ayah-number{display:inline-flex;width:30px;height:30px;align-items:center;justify-content:center;
border-radius:50%;background:var(--panel);color:var(--accent);font-size:16px;font-weight:bold;
cursor:pointer;margin-left:2px;transition:.2s;position:relative;top:-3px;}
.ayah-number.active{background:var(--accent);color:#000;}

/* Footer */
.footer{padding:10px;text-align:center;border-top:1px solid var(--border);color:var(--accent);position:relative;z-index:10;}

/* Total Tasbeeh Box */
#maBox{position:relative;background:var(--panel);border:1px solid var(--border);border-radius:10px;
padding:12px;margin:10px;width:90%;max-width:300px;text-align:center;margin-top:10px;color:var(--accent);}
#maBox h4{margin-bottom:6px;}
</style>
</head>
<body>
<div class="app">

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <h3>ğŸ“– Ø§Ù„Ø³ÙˆØ±</h3>
  <input type="text" id="surahSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³ÙˆØ±Ø©...">
  <div id="surahList"></div>
</div>
<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<!-- Content -->
<div class="content">
  <div class="header">
    <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
    <button class="menu-btn" onclick="toggleTheme()">ğŸŒ™</button>
    <div class="header-title" id="title">Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
    <button class="menu-btn" onclick="showHome()">ğŸ </button>
    <button class="menu-btn" onclick="changeFontSize(2)">A+</button>
    <button class="menu-btn" onclick="changeFontSize(-2)">A-</button>
  </div>

  <div id="scrollInfo">Ø§Ù„Ø¬Ø²Ø¡: <span id="juz-bar">-</span> | Ø§Ù„Ø­Ø²Ø¨: <span id="hizb-bar">-</span></div>

  <div class="home" id="home">
    <div class="tasbeeh" id="tasbeeh-container"></div>
    <div id="maBox">
      <h4>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªØ³Ø¨ÙŠØ­Ø§Øª</h4>
      <div id="totalCount">0</div>
      <p>ØªØ°ÙƒÙŠØ±: Ø§Ù„Ø°ÙƒØ± ÙŠØ±ÙØ¹ Ø¯Ø±Ø¬Ø§ØªÙƒ ÙˆÙŠÙ‚Ø±Ø¨Ùƒ Ù…Ù† Ø§Ù„Ù„Ù‡ØŒ Ø§Ø³ØªÙ…Ø±!</p>
    </div>
  </div>

  <div class="reader" id="reader"></div>

  <div class="footer">Â© Ø²ÙŠØ§Ø¯ Ø£ÙŠÙ…Ù† Ø§Ù„Ù…ØºØ±Ø¨ÙŠ</div>
</div>
</div>

<audio id="tapSound" preload="auto">
  <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_9b5b4a1a8a.mp3">
</audio>

<script>
// ---------- Storage ----------
const storage={get:(k,d)=>JSON.parse(localStorage.getItem(k)||JSON.stringify(d)),set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
const max=33,radius=75,circ=2*Math.PI*radius;
let ayahFontSize=22,lastTap=0,currentAudio=null;

// ---------- Tasbeeh ----------
const tasbeehs=[
{id:'c1',text:'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡'},{id:'c2',text:'Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡'},{id:'c3',text:'Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±'},
{id:'c4',text:'Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡'},{id:'c5',text:'Ø£Ø´Ù‡Ø¯ Ø£Ù† Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡'},{id:'c6',text:'Ù„Ø§ Ø­ÙˆÙ„ ÙˆÙ„Ø§ Ù‚ÙˆØ© Ø¥Ù„Ø§ Ø¨Ø§Ù„Ù„Ù‡'}
];
const tasbeehContainer=document.getElementById("tasbeeh-container");
const totalCount=document.getElementById("totalCount");
const maBox=document.getElementById("maBox");

function updateTotal(){ 
  const total = tasbeehs.reduce((sum,t)=>sum+(storage.get("tasbeeh",{})[t.id]||0),0);
  totalCount.textContent=total;
}

tasbeehs.forEach(t=>{
  const div=document.createElement("div");
  div.className="circle-box"; div.id=t.id+"-circle"; div.onclick=()=>increment(t.id);
  div.innerHTML=`<svg class="circle-svg" viewBox="0 0 160 160">
    <circle class="circle-bg" cx="80" cy="80" r="75"/>
    <circle class="circle-progress" id="${t.id}-progress" cx="80" cy="80" r="75"/>
  </svg>
  <div class="circle-number" id="${t.id}">0</div>
  <div class="circle-text">${t.text}</div>`;
  tasbeehContainer.appendChild(div);
});

function increment(id){
  const now=Date.now(); if(now-lastTap<180)return; lastTap=now;
  const el=document.getElementById(id); let v=+el.textContent+1; el.textContent=v;
  const audio=document.getElementById("tapSound"); audio.currentTime=0; audio.volume=0.3; audio.play().catch(()=>{});
  storage.set("tasbeeh",{...storage.get("tasbeeh",{}),[id]:v});
  document.getElementById(id+"-progress").style.strokeDashoffset=circ-(v%max)/max*circ;
  updateTotal();
}

function enableLongPress(box,id){
  let timer;
  const start=()=>timer=setTimeout(()=>resetCounter(id),800);
  const end=()=>clearTimeout(timer);
  const el=document.getElementById(box);
  el.addEventListener("touchstart",start); el.addEventListener("mousedown",start);
  el.addEventListener("touchend",end); el.addEventListener("mouseup",end);
  el.addEventListener("mouseleave",end);
}
function resetCounter(id){
  document.getElementById(id).textContent=0;
  storage.set("tasbeeh",{...storage.get("tasbeeh",{}),[id]:0});
  document.getElementById(id+"-progress").style.strokeDashoffset=circ;
  updateTotal();
}
tasbeehs.forEach(t=>enableLongPress(t.id+"-circle",t.id));
tasbeehs.forEach(t=>{
  const v=storage.get("tasbeeh",{})[t.id]||0;
  document.getElementById(t.id).textContent=v;
  document.getElementById(t.id+"-progress").style.strokeDashoffset=circ-(v%max)/max*circ;
});
updateTotal();

// ---------- Font ----------
function changeFontSize(delta){ayahFontSize+=delta;if(ayahFontSize<12)ayahFontSize=12;if(ayahFontSize>40)ayahFontSize=40;document.querySelectorAll('.ayah span').forEach(s=>s.style.fontSize=ayahFontSize+"px");}

// ---------- Menu & Theme ----------
const sidebar=document.getElementById("sidebar");
const overlay=document.getElementById("overlay");
function toggleMenu(){sidebar.classList.toggle("open");overlay.classList.toggle("show");}
function toggleTheme(){document.body.classList.toggle("light");storage.set("theme",document.body.classList.contains("light"));}
if(storage.get("theme",false))document.body.classList.add("light");

// ---------- Surahs ----------
const allSurahs=[
  "Ø§Ù„ÙØ§ØªØ­Ø©","Ø§Ù„Ø¨Ù‚Ø±Ø©","Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†","Ø§Ù„Ù†Ø³Ø§Ø¡","Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©","Ø§Ù„Ø£Ù†Ø¹Ø§Ù…","Ø§Ù„Ø£Ø¹Ø±Ø§Ù","Ø§Ù„Ø£Ù†ÙØ§Ù„","Ø§Ù„ØªÙˆØ¨Ø©","ÙŠÙˆÙ†Ø³",
  "Ù‡ÙˆØ¯","ÙŠÙˆØ³Ù","Ø§Ù„Ø±Ø¹Ø¯","Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…","Ø§Ù„Ø­Ø¬Ø±","Ø§Ù„Ù†Ø­Ù„","Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡","Ø§Ù„ÙƒÙ‡Ù","Ù…Ø±ÙŠÙ…","Ø·Ù‡",
  "Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡","Ø§Ù„Ø­Ø¬","Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†","Ø§Ù„Ù†ÙˆØ±","Ø§Ù„ÙØ±Ù‚Ø§Ù†","Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡","Ø§Ù„Ù†Ù…Ù„","Ø§Ù„Ù‚ØµØµ","Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª","Ø§Ù„Ø±ÙˆÙ…",
  "Ù„Ù‚Ù…Ø§Ù†","Ø§Ù„Ø³Ø¬Ø¯Ø©","Ø§Ù„Ø£Ø­Ø²Ø§Ø¨","Ø³Ø¨Ø£","ÙØ§Ø·Ø±","ÙŠØ³","Ø§Ù„ØµØ§ÙØ§Øª","Øµ","Ø§Ù„Ø²Ù…Ø±","ØºØ§ÙØ±",
  "ÙØµÙ„Øª","Ø§Ù„Ø´ÙˆØ±Ù‰","Ø§Ù„Ø²Ø®Ø±Ù","Ø§Ù„Ø¯Ø®Ø§Ù†","Ø§Ù„Ø¬Ø§Ø«ÙŠØ©","Ø§Ù„Ø£Ø­Ù‚Ø§Ù","Ù…Ø­Ù…Ø¯","Ø§Ù„ÙØªØ­","Ø§Ù„Ø­Ø¬Ø±Ø§Øª","Ù‚",
  "Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª","Ø§Ù„Ø·ÙˆØ±","Ø§Ù„Ù†Ø¬Ù…","Ø§Ù„Ù‚Ù…Ø±","Ø§Ù„Ø±Ø­Ù…Ù†","Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©","Ø§Ù„Ø­Ø¯ÙŠØ¯","Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©","Ø§Ù„Ø­Ø´Ø±","Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©",
  "Ø§Ù„ØµÙ","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†","Ø§Ù„ØªØºØ§Ø¨Ù†","Ø§Ù„Ø·Ù„Ø§Ù‚","Ø§Ù„ØªØ­Ø±ÙŠÙ…","Ø§Ù„Ù…Ù„Ùƒ","Ø§Ù„Ù‚Ù„Ù…","Ø§Ù„Ø­Ø§Ù‚Ø©","Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬",
  "Ù†ÙˆØ­","Ø§Ù„Ø¬Ù†","Ø§Ù„Ù…Ø²Ù…Ù„","Ø§Ù„Ù…Ø¯Ø«Ø±","Ø§Ù„Ù‚ÙŠØ§Ù…Ø©","Ø§Ù„Ø¥Ù†Ø³Ø§Ù†","Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª","Ø§Ù„Ù†Ø¨Ø£","Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª","Ø¹Ø¨Ø³",
  "Ø§Ù„ØªÙƒÙˆÙŠØ±","Ø§Ù„Ø¥Ù†ÙØ·Ø§Ø±","Ø§Ù„Ù…Ø·ÙÙÙŠÙ†","Ø§Ù„Ø¥Ù†Ø´Ù‚Ø§Ù‚","Ø§Ù„Ø¨Ø±ÙˆØ¬","Ø§Ù„Ø·Ø§Ø±Ù‚","Ø§Ù„Ø£Ø¹Ù„Ù‰","Ø§Ù„ØºØ§Ø´ÙŠØ©","Ø§Ù„ÙØ¬Ø±","Ø§Ù„Ø¨Ù„Ø¯",
  "Ø§Ù„Ø´Ù…Ø³","Ø§Ù„Ù„ÙŠÙ„","Ø§Ù„Ø¶Ø­Ù‰","Ø§Ù„Ø´Ø±Ø­","Ø§Ù„ØªÙŠÙ†","Ø§Ù„Ø¹Ù„Ù‚","Ø§Ù„Ù‚Ø¯Ø±","Ø§Ù„Ø¨ÙŠÙ†Ø©","Ø§Ù„Ø²Ù„Ø²Ù„Ø©","Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª",
  "Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©","Ø§Ù„ØªÙƒØ§Ø«Ø±","Ø§Ù„Ø¹ØµØ±","Ø§Ù„Ù‡Ù…Ø²Ø©","Ø§Ù„ÙÙŠÙ„","Ù‚Ø±ÙŠØ´","Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†","Ø§Ù„ÙƒÙˆØ«Ø±","Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†","Ø§Ù„Ù†ØµØ±",
  "Ø§Ù„Ù…Ø³Ø¯","Ø§Ù„Ø¥Ø®Ù„Ø§Øµ","Ø§Ù„ÙÙ„Ù‚","Ø§Ù„Ù†Ø§Ø³"
];
const surahList=document.getElementById("surahList");
const surahSearch=document.getElementById("surahSearch");
function renderSurahList(filter=""){
  surahList.innerHTML="";
  allSurahs.forEach((name,id)=>{
    if(!name.includes(filter))return;
    const div=document.createElement("div");div.className="surah-item";
    div.textContent=(id+1)+" - "+name;
    div.onclick=()=>loadSurah(id+1,name);
    surahList.appendChild(div);
  });
}
renderSurahList();
surahSearch.addEventListener("input",e=>renderSurahList(e.target.value));

// ---------- Load Surah ----------
const reader=document.getElementById("reader");
const home=document.getElementById("home");
const title=document.getElementById("title");
const juzBar=document.getElementById("juz-bar");
const hizbBar=document.getElementById("hizb-bar");
const scrollInfo=document.getElementById("scrollInfo");

function loadSurah(id,name){
  home.style.display="none"; reader.style.display="block"; title.textContent=name;
  toggleMenu(); scrollInfo.style.display="block"; maBox.style.display="none";
  reader.innerHTML="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
  
  fetch(`https://api.quran.com/api/v4/verses/by_chapter/${id}?fields=text_uthmani,juz_number,hizb_number,verse_number&per_page=400`)
  .then(r=>r.json()).then(d=>{
    reader.innerHTML="";
    if(d.verses.length===0) return;

    d.verses.forEach(v=>{
      const a=document.createElement("div"); a.className="ayah";
      a.dataset.juz=v.juz_number; a.dataset.hizb=v.hizb_number;
      const txt=document.createElement("span"); txt.textContent=v.text_uthmani; txt.style.fontSize=ayahFontSize+"px";
      const num=document.createElement("span"); num.className="ayah-number"; num.textContent=v.verse_number;
      num.style.fontSize=Math.round(ayahFontSize*0.7)+"px";
      num.onclick = ()=>{
        if(currentAudio)currentAudio.pause();
        currentAudio = new Audio(`https://cdn.islamic.network/quran/audio/128/ar.alafasy/${v.id}.mp3`);
        currentAudio.play().catch(()=>{});
        document.querySelectorAll(".ayah-number").forEach(n=>n.classList.remove("active"));
        num.classList.add("active");
      };
      a.append(txt,num); reader.appendChild(a);
      a.style.textAlign='center';
    });

    if(d.verses.length>0){ juzBar.textContent=d.verses[0].juz_number; hizbBar.textContent=d.verses[0].hizb_number; }

    const obs=new IntersectionObserver(entries=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          juzBar.textContent=e.target.dataset.juz;
          hizbBar.textContent=e.target.dataset.hizb;
        }
      });
    },{root:reader,rootMargin:'-50% 0px -50% 0px',threshold:0});
    [...reader.children].forEach(a=>obs.observe(a));
  });
}

function showHome(){
  reader.style.display="none"; home.style.display="flex"; title.textContent="Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…";
  scrollInfo.style.display="none"; maBox.style.display="block"; 
  juzBar.textContent='-'; hizbBar.textContent='-';
}
</script>
</body>
</html>
