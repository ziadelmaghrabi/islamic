 <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#1e1e1e; --panel:#2b2b2b; --border:#444; --text:#f0f0f0; --accent:#ffcc00;
}
.light{
  --bg:#f5f0e8; --panel:#e0d7cc; --border:#b6a99a; --text:#000; --accent:#6d4c41;
}
*{box-sizing:border-box;}
body{margin:0;font-family:'Amiri',serif;background:var(--bg);color:var(--text);}
.app{display:flex;height:100vh;overflow:hidden;position:relative;}

/* Sidebar */
.sidebar{
  width:260px; background:var(--panel); border-left:1px solid var(--border); padding:12px; overflow:auto; position:fixed; top:0; right:0; height:100vh; transform:translateX(100%); transition:transform .3s ease; z-index:1000;
}
.sidebar.open{transform:translateX(0);}
.sidebar h3{color:var(--accent);}
.sidebar button{width:100%;padding:10px;border:none;border-radius:8px;background:var(--accent);margin-bottom:10px;cursor:pointer;}
.surah-item{padding:10px;border-bottom:1px solid var(--border);cursor:pointer;}
.surah-item:hover{background:rgba(255,255,255,.08);}

/* Overlay */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.3);display:none;z-index:900;}
.overlay.show{display:block;}

/* Content */
.content{flex:1;display:flex;flex-direction:column;position:relative;}

/* Header */
.header{display:flex;align-items:center;gap:8px;padding:10px;border-bottom:1px solid var(--border);background:var(--bg);z-index:1050;}
.menu-btn{background:var(--accent);border:none;border-radius:8px;padding:6px 10px;cursor:pointer;position:relative;z-index:1100;}
.header-title{flex:1;text-align:center;font-size:22px;color:var(--accent);}

/* Scroll Bar */
#scrollBar{position:sticky;top:0;background:var(--panel);padding:5px 10px;font-weight:bold;color:var(--accent);border-bottom:1px solid var(--border);z-index:1040;text-align:center;}

/* Home - Tasbeeh */
.home{flex:1;display:flex;justify-content:center;align-items:center;}
.tasbeeh{display:flex;gap:60px;}

/* Circle Boxes with SVG and Halo */
.circle-box{
  position:relative;
  width:220px; height:220px;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  cursor:pointer;
  transition: transform 0.3s, box-shadow 0.3s;
  border-radius:50%;
  box-shadow:0 0 20px rgba(0,0,0,0.3);
}
.circle-box:hover{transform: scale(1.08); box-shadow:0 0 40px var(--accent),0 0 80px rgba(255,204,0,0.4);}
.circle-box::before{
  content:"";
  position:absolute; inset:-15px;
  border-radius:50%;
  background: conic-gradient(var(--accent),transparent 70%);
  filter: blur(25px);
  opacity:0.5;
  z-index:-1;
  animation:spin 5s linear infinite;
}
@keyframes spin{from{transform:rotate(0deg);} to{transform:rotate(360deg);}}

/* Circle numbers */
.circle-number{
  font-size:56px; color:var(--accent); font-weight:bold; margin-bottom:10px; z-index:2;
  text-shadow: 0 0 8px rgba(255,204,0,0.6);
}
.circle-text{
  font-size:22px; color:var(--text); font-weight:bold; text-align:center; margin-top:auto; z-index:2;
}
.circle-box button{font-size:18px;padding:10px 14px;border:none;border-radius:12px;background:var(--accent);cursor:pointer; z-index:2;margin-top:8px;}

.circle-svg{
  position:absolute; top:0; left:0; transform:rotate(-90deg);
}
.circle-svg circle{transition: stroke-dashoffset 0.5s cubic-bezier(.68,-0.55,.27,1.55);}

/* Reader */
.reader{flex:1;overflow:auto;padding:20px;text-align:center;display:none;}
.ayah{font-size:28px;line-height:2;margin-bottom:18px;transition:background .3s,transform .3s;position:relative; display:flex; align-items:center; gap:10px;}
.ayah.active{background: rgba(255,204,0,0.2); border-radius:8px; padding:2px 8px; transform:scale(1.02);}

/* Ayah number circle */
.ayah-number{
  display:inline-flex;
  width:32px; height:32px;
  justify-content:center; align-items:center;
  border-radius:50%;
  background:var(--panel);
  color:var(--accent);
  font-weight:bold;
  cursor:pointer;
  flex-shrink:0;
  transition: background 0.3s, color 0.3s;
}
.ayah-number:hover{background:var(--accent); color:#000;}

/* Footer */
.footer{display:flex;justify-content:space-between;padding:10px;border-top:1px solid var(--border);font-size:16px;}
.footer span{font-weight:bold;color:var(--accent);}
@media(max-width:768px){.tasbeeh{flex-direction:column;gap:40px}.sidebar{width:100%;}}
</style>
</head>
<body>
<div class="app">

<div class="sidebar" id="sidebar">
  <h3>ğŸ“– Ø§Ù„Ø³ÙˆØ±</h3>
  <button onclick="showHome()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  <div id="surahList"></div>
</div>
<div class="overlay" id="overlay" onclick="closeMenu()"></div>

<div class="content">
  <div class="header">
    <button class="menu-btn" onclick="toggleMenu()">â˜° Ø§Ù„Ø³ÙˆØ±</button>
    <button class="menu-btn" onclick="toggleTheme()">ğŸŒ™</button>
    <div class="header-title" id="title">Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
  </div>

  <div id="scrollBar">Ø§Ù„Ø¬Ø²Ø¡: <span id="juz-bar">-</span> | Ø§Ù„Ø­Ø²Ø¨: <span id="hizb-bar">-</span></div>

  <div class="home" id="home">
    <div class="tasbeeh">
      <!-- Circle 1 -->
      <div class="circle-box" id="c1-circle">
        <svg class="circle-svg" width="220" height="220">
          <circle cx="110" cy="110" r="100" stroke="var(--panel)" stroke-width="10" fill="none"/>
          <circle cx="110" cy="110" r="100" stroke="var(--accent)" stroke-width="10" fill="none"
                  stroke-dasharray="628.32" stroke-dashoffset="628.32" id="c1-progress"/>
        </svg>
        <div class="circle-number" id="c1">0</div>
        <div class="circle-text">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</div>
        <button onclick="inc('c1')"> Ø§Ø°ÙƒØ±</button>
      </div>
      <!-- Circle 2 -->
      <div class="circle-box" id="c2-circle">
        <svg class="circle-svg" width="220" height="220">
          <circle cx="110" cy="110" r="100" stroke="var(--panel)" stroke-width="10" fill="none"/>
          <circle cx="110" cy="110" r="100" stroke="var(--accent)" stroke-width="10" fill="none"
                  stroke-dasharray="628.32" stroke-dashoffset="628.32" id="c2-progress"/>
        </svg>
        <div class="circle-number" id="c2">0</div>
        <div class="circle-text">Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡</div>
        <button onclick="inc('c2')">Ø§Ø°ÙƒØ±</button>
      </div>
      <!-- Circle 3 -->
      <div class="circle-box" id="c3-circle">
        <svg class="circle-svg" width="220" height="220">
          <circle cx="110" cy="110" r="100" stroke="var(--panel)" stroke-width="10" fill="none"/>
          <circle cx="110" cy="110" r="100" stroke="var(--accent)" stroke-width="10" fill="none"
                  stroke-dasharray="628.32" stroke-dashoffset="628.32" id="c3-progress"/>
        </svg>
        <div class="circle-number" id="c3">0</div>
        <div class="circle-text">Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±</div>
        <button onclick="inc('c3')">Ø§Ø°ÙƒØ±</button>
      </div>
    </div>
  </div>

  <div class="reader" id="reader"></div>

  <div class="footer">
    <div>Ø§Ù„Ø­Ø²Ø¨: <span id="hizb">-</span></div>
    <div>Â© Ø²ÙŠØ§Ø¯ Ø£ÙŠÙ…Ù† Ø§Ù„Ù…ØºØ±Ø¨ÙŠ</div>
    <div>Ø§Ù„Ø¬Ø²Ø¡: <span id="juz">-</span></div>
  </div>
</div>
</div>

<script>
const storage={get(k,d){return JSON.parse(localStorage.getItem(k)||JSON.stringify(d));},set(k,v){localStorage.setItem(k,JSON.stringify(v));}};

/* ===== Tasbeeh Circular with Bounce ===== */
const max=33;
function inc(id){
  const el=document.getElementById(id);
  let v=+el.textContent + 1;
  el.textContent = v;
  storage.set('tasbeeh',{...storage.get('tasbeeh',{c1:0,c2:0,c3:0}),[id]:v});
  updateCircle(id,v);
}
function updateCircle(id,value){
  const circle=document.getElementById(id+'-progress');
  const circumference = 2 * Math.PI * 100; 
  const offset = circumference - (value%max)/max * circumference;
  circle.style.strokeDashoffset = offset;
  const box=document.getElementById(id+'-circle');
  box.style.transform='scale(1.12)';
  setTimeout(()=>{box.style.transform='scale(1)';},200);
}
function loadTasbeeh(){
  const counts=storage.get('tasbeeh',{c1:0,c2:0,c3:0});
  ['c1','c2','c3'].forEach(id=>{
    document.getElementById(id).textContent=counts[id];
    updateCircle(id,counts[id]);
  });
}
loadTasbeeh();

/* ===== Menu & Theme ===== */
const sidebar=document.getElementById("sidebar"), overlay=document.getElementById("overlay");
function toggleMenu(){sidebar.classList.toggle("open"); overlay.classList.toggle("show");}
function closeMenu(){sidebar.classList.remove("open"); overlay.classList.remove("show");}
function toggleTheme(){document.body.classList.toggle("light"); storage.set('theme',document.body.classList.contains('light'));}
if(storage.get('theme',false)) document.body.classList.add('light');

/* ===== Load Surahs ===== */
const surahList=document.getElementById("surahList");
fetch("https://api.quran.com/api/v4/chapters?language=ar")
.then(r=>r.json())
.then(d=>{d.chapters.forEach(s=>{
  const div=document.createElement("div"); div.className="surah-item"; div.textContent=s.id+" - "+s.name_arabic;
  div.onclick=()=>loadSurah(s.id,s.name_arabic); surahList.appendChild(div);
});});

/* ===== Load Ayat Full with clickable numbers ===== */
let currentSurah=null;
let currentAudio=null; 
function loadSurah(id,name){
  currentSurah={id,name};
  document.getElementById("title").textContent=name;
  document.getElementById("home").style.display="none";
  closeMenu();
  const reader=document.getElementById("reader");
  reader.style.display="block"; 
  reader.innerHTML="Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢ÙŠØ§Øª...";
  
  fetch(`https://api.quran.com/api/v4/verses/by_chapter/${id}?fields=text_uthmani,juz_number,hizb_number,verse_number&per_page=350`)
  .then(r=>r.json())
  .then(d=>{
    reader.innerHTML="";
    d.verses.forEach(v=>{
      const a=document.createElement("div");
      a.className="ayah";
      a.dataset.juz=v.juz_number;
      a.dataset.hizb=v.hizb_number;
      a.dataset.verse=v.verse_number;

      // Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© Ø¯Ø§Ø¦Ø±ÙŠ clickable
      const num=document.createElement("div");
      num.className="ayah-number";
      num.textContent=v.verse_number;
      num.onclick=()=>{
        if(currentAudio){
          currentAudio.pause();
          currentAudio.currentTime=0;
        }
        currentAudio=new Audio(`https://cdn.islamic.network/quran/audio/128/ar.alafasy/${v.id}.mp3`);
        currentAudio.play();
      };
      a.appendChild(num);

      const text=document.createElement("span");
      text.textContent=v.text_uthmani;
      a.appendChild(text);

      reader.appendChild(a);
    });

    const lastVerse=storage.get('lastVerse',null);
    if(lastVerse && lastVerse.surah==id){
      const ayah=[...reader.children].find(a=>+a.dataset.verse===lastVerse.verse);
      if(ayah) ayah.scrollIntoView({behavior:"auto"});
    } else reader.scroll({top:0});
  });
}

/* ===== Scroll Highlight Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ ===== */
const reader=document.getElementById("reader");
const observer=new IntersectionObserver(entries=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      [...reader.children].forEach(a=>a.classList.remove('active'));
      e.target.classList.add('active');
      document.getElementById('juz').textContent=e.target.dataset.juz;
      document.getElementById('hizb').textContent=e.target.dataset.hizb;
      document.getElementById('juz-bar').textContent=e.target.dataset.juz;
      document.getElementById('hizb-bar').textContent=e.target.dataset.hizb;
      storage.set('lastVerse',{surah:currentSurah.id,verse:+e.target.dataset.verse});
    }
  });
},{root:reader, rootMargin:'-50% 0px -50% 0px', threshold:0});
new MutationObserver(()=>{[...reader.children].forEach(a=>observer.observe(a));}).observe(reader,{childList:true});

/* ===== Home ===== */
function showHome(){
  document.getElementById("title").textContent="Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…";
  document.getElementById("reader").style.display="none";
  document.getElementById("home").style.display="flex";
  document.getElementById('juz').textContent='-';
  document.getElementById('hizb').textContent='-';
  document.getElementById('juz-bar').textContent='-';
  document.getElementById('hizb-bar').textContent='-';
  storage.set('lastVerse',null);
}
</script>
</body>
</html>
